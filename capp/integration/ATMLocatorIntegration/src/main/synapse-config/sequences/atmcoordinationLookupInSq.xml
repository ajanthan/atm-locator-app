<?xml version="1.0" encoding="UTF-8"?>
<sequence name="atmcoordinationLookupInSq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <log/>
    <payloadFactory media-type="xml">
        <format>
            <soapenv:Envelope xmlns:geo="http://geoservice.sample.org" xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/">
                <soapenv:Header/>
                <soapenv:Body>
                    <p:getZipcode xmlns:p="http://geoservice.sample.org">
                        <!--0 to 1 occurrence-->
                        <xs:x xmlns:xs="http://geoservice.sample.org">$1</xs:x>
                        <!--0 to 1 occurrence-->
                        <xs:y xmlns:xs="http://geoservice.sample.org">$2</xs:y>
                    </p:getZipcode>
                </soapenv:Body>
            </soapenv:Envelope>
        </format>
        <args>
            <arg evaluator="xml" expression="get-property('uri.var.longitude')"/>
            <arg evaluator="xml" expression="get-property('uri.var.latitude')"/>
        </args>
    </payloadFactory>
    <header name="Action" scope="default" value="urn:mediate"/>
    <property name="messageType" scope="axis2" type="STRING" value="text/xml"/>
    <call>
        <endpoint key="GeoEP"/>
    </call>
    <log level="full">
        <property name="xxxxxxxxx" value="GEO response"/>
    </log>
    <filter xmlns:ns="http://geoservice.sample.org" xpath="//ns:getZipcodeResponse/ns:return">
        <then>
            <log level="custom">
                <property name="value" value="coordination valid zip code fond"/>
            </log>
            <property expression="//ns:getZipcodeResponse/ns:return" name="uri.var.zipcode" scope="default" type="STRING"/>
            <log level="custom">
                <property expression="get-property('uri.var.zipcode')" name="zipcode"/>
            </log>
            <sequence key="atmlocatorLookupInSq"/>
        </then>
        <else>
            <log level="full">
                <property name="something wrong" value="zip code not available"/>
            </log>
            <log/>
            <payloadFactory media-type="json">
                <format>{"error":"no records found"}</format>
                <args/>
            </payloadFactory>
            <property name="HTTP_SC" scope="axis2" type="STRING" value="404"/>
            <respond/>
        </else>
    </filter>
</sequence>
